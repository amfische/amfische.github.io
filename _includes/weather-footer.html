<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.1/axios.min.js"></script>
<script src="https://use.fontawesome.com/d3c9e0b791.js"></script>


<script>
	new Vue({
		el: '.display',
		data: {
			city: '',
			country: '',
			temp: 0,
			icon: 'wi-day-sleet-storm'
		},
		methods: {
			getLocalWeather() {
				axios.get('http://ipinfo.io')
					.then((response) => {
						let lat = response.data.loc.split(',')[0]
						let lng = response.data.loc.split(',')[1]
						let openWeatherMapURL = "http://api.openweathermap.org/data/2.5/weather" + 
							"?lat=" + lat + 
							"&lon=" + lng + 
							"&appid=51f61b5f031e34a4e3c790f126690615" + 
							"&units=imperial"
						return axios.get(openWeatherMapURL)
					})
					.then((response) => {
						console.log(response)
						this.city = response.data.name
						this.country = response.data.sys.country
						this.temp = response.data.main.temp
						this.setIcon(response.data.weather[0].icon)
					})
			},
			setIcon(icon) {
				console.log(icon)
				let _this = this
				switch (icon) {
					case '01d':
						_this.icon = 'wi-day-sunny'
						break
					default:
						_this.icon = 'wi-solar-eclipse'
				}
			}
		},
		mounted() {
			this.getLocalWeather()
		}

	})
</script>
<script>
	$(document).ready(function() {

	//function to gather users local weather information based off IP address
	function getLocalWeather() {
		//request to ipinfo.io for user location data
		$.getJSON('http://ipinfo.io', function(data) {
			let lat = data.loc.split(',')[0]
			let lng = data.loc.split(',')[1]

			//setting request URL for OpenWeatherMap with coordinates from user location(IP)
			var openWeatherMapURL = "http://api.openweathermap.org/data/2.5/weather" + 
				"?lat=" + lat + 
				"&lon=" + lng + 
				"&appid=51f61b5f031e34a4e3c790f126690615" + 
				"&units=imperial"

			$.getJSON(openWeatherMapURL, displayResults)
		})
	}

	function displayResults(data) {
		console.log(data, data.main.temp, data.name)
	}
	// getLocalWeather()
	
});
</script>

</body>
</html>