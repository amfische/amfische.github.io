<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.1/axios.min.js"></script>
<script src="https://use.fontawesome.com/d3c9e0b791.js"></script>


<script>
	new Vue({
		el: '.display',
		data: {
			city: '-- --',
			temp: 0,
			unit: 'farenheight',
			icon: 'wi-na',
			iconDescription: '-- --',
			input: '',
			loading: true
		},
		methods: {
			farenheight() {
				if (this.unit !== 'farenheight') {
					this.temp = parseFloat((this.temp * 1.8 + 32).toFixed(2))
					this.unit = 'farenheight'
				}
			},
			celsius() {
				if (this.unit !== 'celsius') {
					this.temp = parseFloat(((this.temp - 32) / 1.8).toFixed(2))
					this.unit = 'celsius'
				}
			},
			getUserLocation() {
				return new Promise((resolve, reject) => {
					navigator.geolocation.getCurrentPosition((position) => {
						resolve(position.coords)
					}, function() {
						reject('Location not available')
					})
				})
			},
			getLocalWeather() {
				this.loading = true
				this.getUserLocation()
					.then((e) => {
						let openWeatherMapURL = "http://api.openweathermap.org/data/2.5/weather" + 
							"?lat=" + e.latitude + 
							"&lon=" + e.longitude + 
							"&appid=51f61b5f031e34a4e3c790f126690615" + 
							"&units=imperial"
						return axios.get(openWeatherMapURL)
					})
					.catch((error) => {
						console.log('error', error)
					})
					.then((response) => {
						this.displayResults(response)
					})
					.catch((error) => {
						console.log('error', error)
					})
			},
			searchWeatherByCity() {
				this.loading = true
				let openWeatherMapURL = "http://api.openweathermap.org/data/2.5/weather" + 
					"?q=" + this.input + 
					"&appid=51f61b5f031e34a4e3c790f126690615" + 
					"&units=imperial"
				axios.get(openWeatherMapURL)
					.then((response) => {
						this.displayResults(response)
					})
					.catch((error) => {
						this.loading = false
						this.setIcon('n/a')
						this.city = '-- --'
						this.temp = 0
						this.iconDescription = 'No results found'
					})
			},
			displayResults(response) {
				this.loading = false
				this.city = response.data.name + ', ' + response.data.sys.country
				this.temp = response.data.main.temp
				this.unit = 'farenheight'
				this.setIcon(response.data.weather[0].icon)
				this.iconDescription = response.data.weather[0].description
			},
			setIcon(icon) {
				let _this = this
				switch (icon) {
					case '01d':
						_this.icon = 'wi-day-sunny'
						break
					case '01n':
						_this.icon = 'wi-night-clear'
						break
					case '02d':
					case '03d':
					case '04d':
						_this.icon = 'wi-day-cloudy'
						break
					case '02n':
					case '03n':
					case '04n':
						_this.icon = 'wi-night-alt-cloudy'
						break	
					case '09d':
						_this.icon = 'wi-day-showers'
						break
					case '09n':
						_this.icon = 'wi-night-alt-showers'
						break
					case '10d':
						_this.icon = 'wi-day-rain'
						break
					case '10n':
						_this.icon = 'wi-night-alt-rain'
						break
					case '11d':
						_this.icon = 'wi-day-lightning'
						break
					case '11n':
						_this.icon = 'wi-night-alt-thunderstorm'
						break
					case '13d':
						_this.icon = 'wi-day-snow'
						break
					case '13n':
						_this.icon = 'wi-night-alt-snow'
						break
					case '50d':
						_this.icon = 'wi-day-fog'
						break
					case '50n':
						_this.icon = 'wi-night-fog'
						break
					default:
						_this.icon = 'wi-na'
				}
			}
		},
		mounted() {
			if ("geolocation" in navigator) {
				this.getLocalWeather()
			} else {
				this.loading = false
				this.setIcon('n/a')
				this.city = '-- --'
				this.temp = 0
				this.iconDescription = 'Geolocation not available in this browser, please try another browser or search by city'
			}
		}

	})
</script>

</body>
</html>